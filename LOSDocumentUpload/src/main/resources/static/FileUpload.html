<html>
<head>
  <script src="/js/jquery-1.11.2.min.js"></script>
</head>

<body>
	<div id="DialogMask" ></div> 
	<h1>Document Upload for Loan ID : <span id="loanId"></span></h1>
	<form id="upload-file-form">
		<input id="mortgageApplicationID" name="mortgageApplicationID" type="text" value="CLNT00022123" />
		<p>Select a Document : <select id="documentTypeId" name="documentTypeId"></select> 
		<input id="documentPayload" type="file" name="documentPayload" accept="*" />
		<input id="upload-file-button" type="button" value="Upload" />
    	<span id="upload-file-message"></span>
	</form>
</body>


<!-- Javascript functions -->
<script>
    $(document).ready(function() {
      $("#upload-file-button").on("click", uploadFile);
      getDocumentListToUpload();
    });
    
    function getCustomerId() {
    	var path = window.location.pathname;
    	var customerId = "";
    	var lastIndex = path.substring(path.lastIndexOf("/"), path.length);
    }
    
    function uploadFile() {
    	
      $.ajax({
        url: "/rest/document/upload",
        type: "POST",
        data: new FormData($("#upload-file-form")[0]),
        enctype: 'multipart/form-data',
        processData: false,
        contentType: false,
        cache: false,
        success: function () {
          $("#upload-file-message").text("File succesfully uploaded");
        },
        error: function () {
          $("#upload-file-message").text("File not uploaded (perhaps it's too much big)");
        }
      });
    } 
    
    function getDocumentListToUpload(){
    	 $.ajax({
                type: "GET",
                url: '/rest/document/documentlist',
                dataType: 'json',
                success: function(json) {
                    var $el = $("#documentTypeId");
                    $el.empty(); // remove old options
                    $el.append($("<option></option>").attr("value", '').text('Please Select'));
                	for(var prop in json) {
                        $el.append($("<option></option>").attr("value", json[prop].documentTypeId).text(json[prop].documentDescription));
                    }
                }
            });
    }
</script>
</html>